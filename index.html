<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä —Å Vue.js</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="icon" href="public/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
      .month-container {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 10px;
      }

      .month-box {
        width: 100%;
        height: 120px;
        border: 1px solid #ccc;
        text-align: center;
        cursor: pointer;
        position: relative;
        transition: transform 0.2s ease;
      }

      .month-box:hover {
        transform: scale(1.05);
      }

      .month-box.selected {
        border: 3px solid #000;
        filter: brightness(90%);
      }

      .month-box .month-title {
        font-size: 14px;
        font-weight: bold;
        margin-top: 10px;
      }

      .month-box .term-count {
        font-size: 12px;
        color: #666;
        position: absolute;
        bottom: 5px;
        width: 100%;
      }

      .month-label {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: normal;
        color: #000; /* –ß–µ—Ä–µ–Ω —Ç–µ–∫—Å—Ç –∑–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
      }

      .term-entry {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
      }

      .term-entry div:first-child {
        flex: 1;
      }

      .term-entry button {
        margin-left: 5px;
      }

      .language-selector {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 10px; /* –†–∞–∑—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ñ–ª–∞–≥–æ–≤–µ—Ç–µ */
        align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–∞ —Ñ–ª–∞–≥–æ–≤–µ—Ç–µ –≤–µ—Ä—Ç–∏–∫–∞–ª–Ω–æ */
      }

      .language-selector img {
        width: 30px;
        height: 20px;
        cursor: pointer;
        border: 2px solid #ccc; /* –õ–µ–∫–∞ —Ä–∞–º–∫–∞ –∑–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
        border-radius: 5px; /* –ó–∞–æ–±–ª–µ–Ω–∏ —Ä—ä–±–æ–≤–µ */
        background-color: #f8f9fa; /* –°–≤–µ—Ç—ä–ª —Å–∏–≤ —Ñ–æ–Ω */
        transition: transform 0.2s ease, box-shadow 0.2s ease; /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Ö–æ–≤—ä—Ä */
      }

      .language-selector img:hover {
        transform: scale(1.1); /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ —Ö–æ–≤—ä—Ä */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* –°–µ–Ω–∫–∏ –∑–∞ –µ—Ñ–µ–∫—Ç */
      }

      .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        margin-right: 5px;
      }

      @media (max-width: 1200px) {
        .month-container {
          grid-template-columns: repeat(6, 1fr);
        }
      }

      @media (max-width: 768px) {
        .month-container {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      @media (max-width: 576px) {
        .month-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      .screenshot-mode {
        background-color: #198754 !important; /* –ó–µ–ª–µ–Ω —Ñ–æ–Ω */
        color: white !important; /* –ë—è–ª–∞ –∏–∫–æ–Ω–∞ */
        border-color: #198754 !important;
      }
      #downloadSnapshotBtn:hover,
      #downloadSnapshotBtn:focus {
        background-color: #198754;
        border-color: #198754;
        color: white;
      }

      @media (max-width: 576px) {
        .month-container {
          grid-template-columns: repeat(2, 1fr);
        }

        .month-box .month-title {
          font-size: 16px;
        }

        .month-box .term-count {
          font-size: 14px;
          position: static;
          margin-top: 5px;
        }

        .month-box {
          height: auto;
          padding: 10px 5px;
        }

        .term-card {
          background: #fff;
          border: 1px solid #ddd;
          border-radius: 10px;
          padding: 10px;
          margin-bottom: 10px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .term-card .term-date {
          font-weight: bold;
          margin-bottom: 5px;
        }

        .term-card .term-text {
          margin-bottom: 10px;
        }

        .term-card .term-actions {
          display: flex;
          gap: 5px;
          justify-content: flex-end;
        }

        /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –ø–æ–∫–∞–∑–≤–∞–º–µ –∏ —Ç–µ–∫—Å—Ç */
        .btn-responsive i {
          margin-right: 5px;
        }

        /* –ü–æ–¥ 576px ‚Äî –ø–æ–∫–∞–∑–≤–∞–º–µ —Å–∞–º–æ –∏–∫–æ–Ω–∞ */
        @media (max-width: 576px) {
          .btn-responsive {
            padding: 6px 10px;
            font-size: 1.1rem;
          }

          .btn-responsive span {
            display: none;
          }

          .btn-responsive i {
            margin-right: 0; /* –º–∞—Ö–∞–º–µ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ—Ç–æ */
          }
        }
      }
    </style>
  </head>
  <body>
    <div id="app" class="container mt-5 position-relative">
      <!-- Language selector -->
      <div class="language-selector">
        <img src="https://flagcdn.com/w40/bg.png" alt="–ë—ä–ª–≥–∞—Ä—Å–∫–∏" @click="setLanguage('bg')" />
        <img src="https://flagcdn.com/w40/de.png" alt="–ù–µ–º—Å–∫–∏" @click="setLanguage('de')" />
      </div>

      <!-- Main content -->
      <div class="mb-3">
        <label for="year" class="form-label">{{ labels.year }}</label>
        <select v-model="selectedYear" class="form-select" id="year">
          <option v-for="year in years" :key="year" :value="year">{{ year }}</option>
        </select>
      </div>

      <div class="mb-3 d-flex justify-content-end gap-2 flex-wrap">
        <button class="btn btn-outline-dark btn-responsive" @click="downloadJSON">
          <i class="bi bi-download"></i> <span>{{ labels.saveFile || '–ó–∞–ø–∞–∑–∏ —Ñ–∞–π–ª' }}</span>
        </button>

        <button class="btn btn-outline-primary btn-responsive" @click="triggerFileInput">
          <i class="bi bi-upload"></i> <span>{{ labels.loadFile || '–ó–∞—Ä–µ–¥–∏ —Ñ–∞–π–ª' }}</span>
        </button>

        <input type="file" id="fileInput" ref="fileInput" accept=".json" @change="loadFromFile" style="display: none" />

        <button class="btn btn-outline-warning btn-responsive" @click="restoreFromBackup">
          <i class="bi bi-arrow-counterclockwise"></i> <span>{{ labels.restoreFile }}</span>
        </button>

        <button
          id="downloadSnapshotBtn"
          @click="takeScreenshot"
          class="btn btn-outline-success rounded d-flex align-items-center justify-content-center"
          style="width: 44px; height: 44px"
          :title="labels.takeScreenshot"
        >
          <i class="bi bi-camera" style="font-size: 1.2rem"></i>
        </button>
      </div>

      <div v-if="selectedYear" class="mb-3">
        <h5>{{ labels.monthsFor }} {{ selectedYear }}:</h5>
        <div class="month-container">
          <div
            v-for="(month, index) in months[selectedLanguage]"
            :key="index"
            class="month-box"
            :class="{ selected: selectedMonths.includes(index) }"
            :style="{ backgroundColor: colors[index] }"
            @click="toggleMonth(index)"
          >
            <div class="month-title">{{ month }}</div>
            <div class="term-count">{{ labels.terms }}: {{ terms[selectedYear]?.[index]?.length || 0 }}</div>
          </div>
        </div>
      </div>

      <div v-if="selectedMonths.length > 0" class="mt-4">
        <h5>{{ labels.terms }}</h5>
        <div v-for="monthIndex in selectedMonths" :key="monthIndex" class="mb-3">
          <label :for="'month-' + monthIndex" class="month-label" :style="{ backgroundColor: colors[monthIndex] }">
            {{ months[selectedLanguage][monthIndex] }}
          </label>
          <div class="term-entry">
            <input
              v-model="newTerm[monthIndex]"
              type="text"
              class="form-control"
              :id="'month-' + monthIndex"
              :placeholder="labels.addTerm"
            />
            <select v-model="selectedDay[monthIndex]" class="form-select">
              <option value="" disabled>{{ labels.addDay }}</option>
              <option v-for="day in daysInMonth(monthIndex + 1, selectedYear)" :key="day" :value="day">
                {{ day }} - {{ getDayOfWeek(selectedYear, monthIndex + 1, day) }}
              </option>
            </select>

            <button @click="addTerm(monthIndex)" class="btn btn-primary" :disabled="isLoading">
              <span v-if="isLoading">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </span>
              <span v-else>{{ labels.add }}</span>
            </button>
          </div>

          <ul class="mt-2" v-if="!isMobileView">
            <li
              v-for="(term, termIndex) in terms[selectedYear]?.[monthIndex] || []"
              :key="term.day + term.text.bg"
              class="d-flex justify-content-between align-items-center"
            >
              <div class="flex-grow-1 d-flex align-items-center">
                <span
                  v-if="!(editIndex === termIndex && editMonthIndex === monthIndex)"
                  class="text-truncate"
                  style="width: 100%"
                >
                  {{ term.day }} ({{ getDayOfWeek(selectedYear, monthIndex + 1, term.day) }}): {{
                  term.text[selectedLanguage] }}
                </span>
                <input
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  v-model="editText[selectedLanguage]"
                  type="text"
                  class="form-control me-2"
                  style="flex: 1 1 auto"
                />
              </div>

              <div>
                <button
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  @click="saveEdit"
                  class="btn btn-success btn-sm ms-2"
                >
                  Save
                </button>
                <button
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  @click="cancelEdit"
                  class="btn btn-secondary btn-sm ms-2"
                >
                  Cancel
                </button>
                <button
                  v-else
                  @click="startEditing(monthIndex, termIndex)"
                  class="btn btn-sm btn-outline-secondary ms-2"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button @click="deleteTerm(monthIndex, termIndex)" class="btn btn-sm btn-outline-danger ms-2">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </li>
          </ul>

          <!-- –ú–æ–±–∏–ª–µ–Ω –∏–∑–≥–ª–µ–¥ -->
          <div v-if="isMobileView">
            <div
              class="term-card"
              v-for="(term, termIndex) in terms[selectedYear]?.[monthIndex] || []"
              :key="term.day + term.text.bg"
            >
              <div class="term-date">{{ term.day }} ({{ getDayOfWeek(selectedYear, monthIndex + 1, term.day) }})</div>
              <div class="term-text">
                <span v-if="!(editIndex === termIndex && editMonthIndex === monthIndex)">
                  {{ term.text[selectedLanguage] }}
                </span>
                <input
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  v-model="editText[selectedLanguage]"
                  type="text"
                  class="form-control"
                />
              </div>
              <div class="term-actions">
                <button
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  @click="saveEdit"
                  class="btn btn-success btn-sm"
                >
                  Save
                </button>
                <button
                  v-if="editIndex === termIndex && editMonthIndex === monthIndex"
                  @click="cancelEdit"
                  class="btn btn-secondary btn-sm"
                >
                  Cancel
                </button>
                <button v-else @click="startEditing(monthIndex, termIndex)" class="btn btn-sm btn-outline-secondary">
                  <i class="bi bi-pencil"></i>
                </button>
                <button @click="deleteTerm(monthIndex, termIndex)" class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-if="alertMessage" :class="['alert', 'alert-' + alertType]" role="alert">{{ alertMessage }}</div>
    </div>

    <script>
      new Vue({
        el: "#app",
        data: {
          currentYear: new Date().getFullYear(),
          selectedYear: null,
          selectedLanguage: "bg",
          labels: {
            year: "–ò–∑–±–µ—Ä–∏ –≥–æ–¥–∏–Ω–∞:",
            monthsFor: "–ú–µ—Å–µ—Ü–∏ –∑–∞",
            terms: "–¢–µ—Ä–º–∏–Ω–∏",
            addTerm: "–î–æ–±–∞–≤–∏ —Ç–µ—Ä–º–∏–Ω",
            add: "–î–æ–±–∞–≤–∏",
            addDay: "–î–æ–±–∞–≤–∏ –¥–∞—Ç–∞", // –î–∏–Ω–∞–º–∏—á–Ω–æ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –¥–µ–Ω
            screenshot: "–ó–∞—Å–Ω–µ–º–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä",
          },
          translations: {
            bg: {
              year: "–ò–∑–±–µ—Ä–∏ –≥–æ–¥–∏–Ω–∞:",
              monthsFor: "–ú–µ—Å–µ—Ü–∏ –∑–∞",
              terms: "–¢–µ—Ä–º–∏–Ω–∏",
              addTerm: "–î–æ–±–∞–≤–∏ —Ç–µ—Ä–º–∏–Ω",
              add: "–î–æ–±–∞–≤–∏",
              addDay: "–î–æ–±–∞–≤–∏ –¥–∞—Ç–∞", // –ü—Ä–µ–≤–æ–¥ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏
              deleteConfirm: "–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ —Ç–µ—Ä–º–∏–Ω?",
              screenshot: "–ó–∞—Å–Ω–µ–º–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä",
            },
            de: {
              year: "W√§hle ein Jahr:",
              monthsFor: "Monate f√ºr",
              terms: "Termine",
              addTerm: "Termin hinzuf√ºgen",
              add: "Hinzuf√ºgen",
              addDay: "Datum hinzuf√ºgen", // –ü—Ä–µ–≤–æ–¥ –Ω–∞ –Ω–µ–º—Å–∫–∏
              deleteConfirm: "Sind Sie sicher, dass Sie diesen Termin l√∂schen m√∂chten?",
              screenshot: "Screenshot erstellen",
            },
          },
          months: {
            bg: [
              "–Ø–Ω—É–∞—Ä–∏",
              "–§–µ–≤—Ä—É–∞—Ä–∏",
              "–ú–∞—Ä—Ç",
              "–ê–ø—Ä–∏–ª",
              "–ú–∞–π",
              "–Æ–Ω–∏",
              "–Æ–ª–∏",
              "–ê–≤–≥—É—Å—Ç",
              "–°–µ–ø—Ç–µ–º–≤—Ä–∏",
              "–û–∫—Ç–æ–º–≤—Ä–∏",
              "–ù–æ–µ–º–≤—Ä–∏",
              "–î–µ–∫–µ–º–≤—Ä–∏",
            ],
            de: [
              "Januar",
              "Februar",
              "M√§rz",
              "April",
              "Mai",
              "Juni",
              "Juli",
              "August",
              "September",
              "Oktober",
              "November",
              "Dezember",
            ],
          },
          colors: [
            "#FFCCCC",
            "#FFE6CC",
            "#FFFFCC",
            "#E6FFCC",
            "#CCFFCC",
            "#CCFFE6",
            "#CCFFFF",
            "#CCE5FF",
            "#CCCCFF",
            "#E6CCFF",
            "#FFCCFF",
            "#FFCCE5",
          ],
          selectedMonths: [],
          terms: {},
          newTerm: {},
          selectedDay: {},
          editIndex: null,
          editMonthIndex: null,
          editText: "",
          isLoading: false,
          labels: {
            year: "–ò–∑–±–µ—Ä–∏ –≥–æ–¥–∏–Ω–∞:",
            monthsFor: "–ú–µ—Å–µ—Ü–∏ –∑–∞",
            terms: "–¢–µ—Ä–º–∏–Ω–∏",
            addTerm: "–î–æ–±–∞–≤–∏ —Ç–µ—Ä–º–∏–Ω",
            add: "–î–æ–±–∞–≤–∏",
            addDay: "–î–æ–±–∞–≤–∏ –¥–∞—Ç–∞",
            saveFile: "–ó–∞–ø–∞–∑–∏ —Ñ–∞–π–ª",
            loadFile: "–ó–∞—Ä–µ–¥–∏ —Ñ–∞–π–ª", // ‚ûï –ù–æ–≤ —Ä–µ–¥
            restoreFile: "–í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –∞—Ä—Ö–∏–≤",
          },
          translations: {
            bg: {
              year: "–ò–∑–±–µ—Ä–∏ –≥–æ–¥–∏–Ω–∞:",
              monthsFor: "–ú–µ—Å–µ—Ü–∏ –∑–∞",
              terms: "–¢–µ—Ä–º–∏–Ω–∏",
              addTerm: "–î–æ–±–∞–≤–∏ —Ç–µ—Ä–º–∏–Ω",
              add: "–î–æ–±–∞–≤–∏",
              addDay: "–î–æ–±–∞–≤–∏ –¥–∞—Ç–∞",
              deleteConfirm: "–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ —Ç–µ—Ä–º–∏–Ω?",
              saveFile: "–ó–∞–ø–∞–∑–∏ —Ñ–∞–π–ª",
              loadFile: "–ó–∞—Ä–µ–¥–∏ —Ñ–∞–π–ª", // ‚ûï –ù–æ–≤ —Ä–µ–¥
              loadSuccess: "–î–∞–Ω–Ω–∏—Ç–µ –±—è—Ö–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–¥–µ–Ω–∏.",
              loadError: "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞.",
              restoreSuccess: "–£—Å–ø–µ—à–Ω–æ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–µ–Ω –∞—Ä—Ö–∏–≤!",
              restoreError: "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∞—Ä—Ö–∏–≤–∞.",
              restoreFile: "–í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –∞—Ä—Ö–∏–≤",
              noBackup: "–ù—è–º–∞ –Ω–∞–ª–∏—á–µ–Ω –∞—Ä—Ö–∏–≤.",
              yearFallback: "–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ {year}, –∑–∞—Ä–µ–∂–¥–∞–º {fallbackYear}.",
              noDataToSave: "–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ.",
            },
            de: {
              year: "W√§hle ein Jahr:",
              monthsFor: "Monate f√ºr",
              terms: "Termine",
              addTerm: "Termin hinzuf√ºgen",
              add: "Hinzuf√ºgen",
              addDay: "Datum hinzuf√ºgen",
              deleteConfirm: "Sind Sie sicher, dass Sie diesen Termin l√∂schen m√∂chten?",
              saveFile: "Datei speichern",
              loadFile: "Datei laden", // ‚ûï –ù–æ–≤ —Ä–µ–¥
              loadSuccess: "Daten wurden erfolgreich geladen.",
              loadError: "Fehler beim Laden der Datei.",
              restoreSuccess: "Sicherung erfolgreich wiederhergestellt!",
              restoreError: "Fehler beim Wiederherstellen der Sicherung.",
              restoreFile: "Backup wiederherstellen",
              noBackup: "Keine Sicherung verf√ºgbar.",
              yearFallback: "Keine Daten f√ºr {year}, lade {fallbackYear}.",
              noDataToSave: "Keine Daten zum Speichern vorhanden.", // üîÅ –Ω–æ–≤–æ –∑–∞ de
            },
          },
          alertMessage: "",
          alertType: "", // "success" –∏–ª–∏ "danger"
        },
        computed: {
          years() {
            return [this.currentYear - 1, this.currentYear, this.currentYear + 1];
          },
          isMobileView() {
            return window.innerWidth <= 576;
          },
        },
        mounted() {
          this.loadFromLocalStorage();

          const availableYears = Object.keys(this.terms)
            .map(Number)
            .sort((a, b) => b - a); // —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∏–∑—Ö–æ–¥—è—â–æ

          if (availableYears.includes(this.currentYear)) {
            this.selectedYear = this.currentYear;
          } else if (availableYears.length > 0) {
            this.selectedYear = availableYears[0];
            this.showAlert(
              this.translations[this.selectedLanguage].yearFallback
                .replace("{year}", this.currentYear)
                .replace("{fallbackYear}", this.selectedYear),
              "warning"
            );
          } else {
            this.selectedYear = this.currentYear;
          }

          // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏—Ç–µ –º–µ—Å–µ—Ü–∏ –æ—Ç localStorage
          const storedSelectedMonths = localStorage.getItem(`selectedMonths_${this.selectedYear}`);
          if (storedSelectedMonths) {
            this.selectedMonths = JSON.parse(storedSelectedMonths);
          } else {
            this.selectedMonths = [];
          }

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ selectedDay –∑–∞ –≤—Å–µ–∫–∏ –∏–∑–±—Ä–∞–Ω –º–µ—Å–µ—Ü
          this.selectedMonths.forEach((index) => {
            if (!this.selectedDay[index]) {
              this.$set(this.selectedDay, index, "");
            }
          });
        },
        methods: {
          setLanguage(lang) {
            this.selectedLanguage = lang;
            this.labels = this.translations[lang];
            this.updateDayNames();
          },
          updateDayNames() {
            this.daysOfWeek =
              this.selectedLanguage === "bg"
                ? ["–ù–µ–¥–µ–ª—è", "–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä—è–¥–∞", "–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫", "–ü–µ—Ç—ä–∫", "–°—ä–±–æ—Ç–∞"]
                : ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"];
          },
          daysInMonth(month, year) {
            return new Date(year, month, 0).getDate();
          },
          toggleMonth(index) {
            if (!this.terms[this.selectedYear]) {
              this.$set(this.terms, this.selectedYear, {});
            }

            if (!this.selectedMonths.includes(index)) {
              this.selectedMonths.push(index);
              if (!this.terms[this.selectedYear][index]) {
                this.$set(this.terms[this.selectedYear], index, []);
              }
              // –ó–∞–¥–∞–≤–∞ –ø—Ä–∞–∑–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –∑–∞ –∏–∑–±—Ä–∞–Ω–∏—è –¥–µ–Ω –ø—Ä–∏ —Å–µ–ª–µ–∫—Ü–∏—è –Ω–∞ –º–µ—Å–µ—Ü
              this.$set(this.selectedDay, index, "");
            } else {
              this.selectedMonths = this.selectedMonths.filter((month) => month !== index);
              // –ó–∞–¥–∞–≤–∞ –ø—Ä–∞–∑–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –∑–∞ –∏–∑–±—Ä–∞–Ω–∏—è –¥–µ–Ω –ø—Ä–∏ –¥–µ—Å–µ–ª–µ–∫—Ü–∏—è –Ω–∞ –º–µ—Å–µ—Ü
              this.$set(this.selectedDay, index, "");
            }

            this.selectedMonths.sort((a, b) => a - b);
            // –ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏—Ç–µ –º–µ—Å–µ—Ü–∏ –≤ localStorage
            this.saveSelectedMonths();
          },
          saveSelectedMonths() {
            localStorage.setItem(`selectedMonths_${this.selectedYear}`, JSON.stringify(this.selectedMonths));
          },

          async addTerm(monthIndex) {
            if (!this.terms[this.selectedYear]) {
              this.$set(this.terms, this.selectedYear, {});
            }

            if (!this.terms[this.selectedYear][monthIndex]) {
              this.$set(this.terms[this.selectedYear], monthIndex, []);
            }

            if (this.newTerm[monthIndex] && this.selectedDay[monthIndex]) {
              const termText = this.newTerm[monthIndex];
              let translatedText = "";

              const langPair = this.selectedLanguage === "bg" ? "bg|de" : "de|bg";

              this.isLoading = true;

              try {
                const response = await axios.get(
                  `https://api.mymemory.translated.net/get?q=${encodeURIComponent(termText)}&langpair=${langPair}`
                );
                translatedText = response.data.responseData.translatedText;
              } catch (error) {
                console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤–æ–¥–∞:", error);
              } finally {
                this.isLoading = false;
              }

              const textObject =
                this.selectedLanguage === "bg"
                  ? { bg: termText, de: translatedText }
                  : { bg: translatedText, de: termText };

              this.terms[this.selectedYear][monthIndex].push({
                day: parseInt(this.selectedDay[monthIndex], 10),
                text: textObject,
              });

              this.terms[this.selectedYear][monthIndex].sort((a, b) => a.day - b.day);
              // –†–µ—Å–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ—Ç–æ –ø–æ–ª–µ –∏ –ø–∞–¥–∞—â–æ—Ç–æ –º–µ–Ω—é
              this.newTerm[monthIndex] = "";
              this.$set(this.selectedDay, monthIndex, ""); // –†–µ—Å–µ—Ç –Ω–∞ –∏–∑–±—Ä–∞–Ω–∏—è –¥–µ–Ω
            }
          },
          getDayOfWeek(year, month, day) {
            const days =
              this.selectedLanguage === "bg"
                ? ["–ù–µ–¥–µ–ª—è", "–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä—è–¥–∞", "–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫", "–ü–µ—Ç—ä–∫", "–°—ä–±–æ—Ç–∞"]
                : ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"];
            return days[new Date(year, month - 1, day).getDay()];
          },
          startEditing(monthIndex, termIndex) {
            this.editIndex = termIndex;
            this.editMonthIndex = monthIndex;
            this.editText = { ...this.terms[this.selectedYear][monthIndex][termIndex].text };
          },
          saveEdit() {
            if (this.editText[this.selectedLanguage].trim() !== "") {
              const editedText = this.editText[this.selectedLanguage].trim();
              const targetLang = this.selectedLanguage === "bg" ? "de" : "bg";

              this.isLoading = true;

              axios
                .get(
                  `https://api.mymemory.translated.net/get?q=${encodeURIComponent(editedText)}&langpair=${
                    this.selectedLanguage
                  }|${targetLang}`
                )
                .then((response) => {
                  const translatedText = response.data.responseData.translatedText;

                  this.terms[this.selectedYear][this.editMonthIndex][this.editIndex].text[this.selectedLanguage] =
                    editedText;
                  this.terms[this.selectedYear][this.editMonthIndex][this.editIndex].text[targetLang] = translatedText;
                })
                .catch((error) => {
                  console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤–æ–¥–∞:", error);
                })
                .finally(() => {
                  this.isLoading = false;
                  this.cancelEdit();
                });
            } else {
              this.cancelEdit();
            }
          },
          cancelEdit() {
            this.editIndex = null;
            this.editMonthIndex = null;
            this.editText = {};
          },
          deleteTerm(monthIndex, termIndex) {
            const confirmMessage = this.translations[this.selectedLanguage].deleteConfirm;
            if (confirm(confirmMessage)) {
              this.terms[this.selectedYear][monthIndex].splice(termIndex, 1);
            }
          },
          saveToLocalStorage() {
            localStorage.setItem("calendarData", JSON.stringify(this.terms));
          },
          loadFromLocalStorage() {
            const backup = localStorage.getItem("calendar_backup");

            if (backup) {
              try {
                const parsed = JSON.parse(backup);

                if (parsed.terms && parsed.config) {
                  this.terms = parsed.terms;
                  this.selectedYear = parsed.config.selectedYear;
                  this.selectedLanguage = parsed.config.selectedLanguage || "bg";
                  this.selectedMonths = parsed.config.selectedMonths || [];
                  this.rememberSelection = parsed.config.rememberSelection ?? true;
                } else {
                  this.terms = parsed;
                  this.selectedYear = this.currentYear;
                  this.selectedLanguage = "bg";
                  this.selectedMonths = [];
                }

                Object.keys(this.terms).forEach((year) => {
                  Object.keys(this.terms[year]).forEach((month) => {
                    const monthData = this.terms[year][month];
                    if (!Array.isArray(monthData)) {
                      this.terms[year][month] = [];
                    } else {
                      this.terms[year][month].sort((a, b) => a.day - b.day);
                    }
                  });
                });

                this.selectedMonths.forEach((index) => {
                  if (!this.selectedDay[index]) {
                    this.$set(this.selectedDay, index, "");
                  }
                });
              } catch (e) {
                console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ backup:", e);
              }
            } else {
              const storedData = localStorage.getItem("calendarData");
              if (storedData) {
                this.terms = JSON.parse(storedData);
                this.selectedYear = this.currentYear;
                this.selectedLanguage = "bg";
                this.selectedMonths = Object.keys(this.terms[this.selectedYear] || {}).map(Number);
              } else {
                this.terms = {};
                this.selectedYear = this.currentYear;
                this.selectedLanguage = "bg";
                this.selectedMonths = [];
              }
            }
          },
          downloadJSON() {
            if (!this.terms || Object.keys(this.terms).length === 0) {
              this.showAlert(this.translations[this.selectedLanguage].noDataToSave, "warning");
              return;
            }

            const fullData = {
              terms: this.terms,
              config: {
                selectedYear: this.selectedYear,
                selectedLanguage: this.selectedLanguage,
                selectedMonths: this.selectedMonths,
                rememberSelection: true,
              },
            };

            const dataStr = JSON.stringify(fullData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/[:T]/g, "-");
            a.download = `calendar_ALL_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // –∞—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ
            localStorage.setItem("calendar_backup", JSON.stringify(fullData));
          },
          triggerFileInput() {
            this.$refs.fileInput.click();
          },
          loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = (e) => {
              try {
                const json = JSON.parse(e.target.result);

                if (json.terms && json.config) {
                  this.terms = json.terms;
                  this.selectedYear = json.config.selectedYear;
                  this.selectedLanguage = json.config.selectedLanguage || "bg";
                  this.selectedMonths = json.config.selectedMonths || [];
                  this.rememberSelection = json.config.rememberSelection ?? true;

                  this.saveSelectedMonths();
                } else {
                  // —Å—Ç–∞—Ä —Ñ–æ—Ä–º–∞—Ç, –±–µ–∑ config
                  this.terms = json;
                }

                // —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ
                Object.keys(this.terms).forEach((year) => {
                  Object.keys(this.terms[year]).forEach((month) => {
                    const monthData = this.terms[year][month];
                    if (!Array.isArray(monthData)) {
                      // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø—Ä–∞–≤—è–Ω–µ –Ω–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏
                      this.terms[year][month] = [];
                    } else {
                      this.terms[year][month].sort((a, b) => a.day - b.day);
                    }
                  });
                });

                localStorage.setItem("calendar_backup", JSON.stringify(json));
                this.showAlert(this.translations[this.selectedLanguage].loadSuccess, "success");
              } catch (err) {
                this.showAlert(this.translations[this.selectedLanguage].loadError, "danger");
                console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ JSON:", err);
              }

              event.target.value = ""; // —Ä–µ—Å–µ—Ç input
            };

            reader.readAsText(file);
          },
          restoreFromBackup() {
            const backup = localStorage.getItem("calendar_backup");
            if (backup) {
              try {
                const parsed = JSON.parse(backup);

                if (parsed.terms && typeof parsed.terms === "object" && Object.keys(parsed.terms).length > 0) {
                  this.terms = parsed.terms;
                  const config = parsed.config || {};
                  this.selectedYear = config.selectedYear || this.currentYear;
                  this.selectedLanguage = config.selectedLanguage || "bg";
                  this.selectedMonths = config.selectedMonths || [];
                  this.rememberSelection = config.rememberSelection ?? true;

                  Object.keys(this.terms).forEach((year) => {
                    Object.keys(this.terms[year]).forEach((month) => {
                      const monthData = this.terms[year][month];
                      if (!Array.isArray(monthData)) {
                        this.terms[year][month] = [];
                      } else {
                        this.terms[year][month].sort((a, b) => a.day - b.day);
                      }
                    });
                  });

                  // –°–µ—Ç–≤–∞–º–µ –ø—Ä–∞–∑–Ω–∏ –¥–Ω–∏ –∑–∞ –≤—Å–µ–∫–∏ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω –º–µ—Å–µ—Ü
                  this.selectedMonths.forEach((index) => {
                    if (!this.selectedDay[index]) {
                      this.$set(this.selectedDay, index, "");
                    }
                  });

                  this.saveSelectedMonths();
                  this.showAlert(this.translations[this.selectedLanguage].restoreSuccess, "success");
                } else {
                  throw new Error("–ê—Ä—Ö–∏–≤—ä—Ç –Ω–µ —Å—ä–¥—ä—Ä–∂–∞ –≤–∞–ª–∏–¥–Ω–∏ –¥–∞–Ω–Ω–∏.");
                }
              } catch (err) {
                this.showAlert(this.translations[this.selectedLanguage].restoreError, "danger");
                console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∞—Ä—Ö–∏–≤–∞:", err);
              }
            } else {
              this.showAlert(this.translations[this.selectedLanguage].noBackup, "warning");
            }
          },
          takeScreenshot() {
            const element = document.getElementById("app");
            const cameraButton = document.getElementById("downloadSnapshotBtn");

            // üëâ –°—ä–∑–¥–∞–≤–∞–º–µ –ø—Ä–∞–∑–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –∑–∞ –¥–æ–ª–µ–Ω –º–∞—Ä–≥–∏–Ω
            const paddingDiv = document.createElement("div");
            paddingDiv.style.height = "40px";
            paddingDiv.id = "screenshot-padding";
            element.appendChild(paddingDiv);

            // –ó–µ–ª–µ–Ω –±—É—Ç–æ–Ω –∑–∞ —Ä–µ–∂–∏–º —Å–Ω–∏–º–∫–∞
            cameraButton.classList.add("screenshot-mode");

            html2canvas(element, {
              scale: 2,
              useCORS: true,
              backgroundColor: "#ffffff",
            }).then((canvas) => {
              // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ padding —Å–ª–µ–¥ —Å–Ω–∏–º–∫–∞—Ç–∞
              const addedPadding = document.getElementById("screenshot-padding");
              if (addedPadding) addedPadding.remove();

              const link = document.createElement("a");
              const now = new Date();
              const timestamp = now.toISOString().slice(0, 19).replace(/[:T]/g, "-");
              link.download = `calendar_snapshot_${timestamp}.png`;
              link.href = canvas.toDataURL();
              link.click();
              // üëâ –í—Ä—ä—â–∞–º–µ –±—É—Ç–æ–Ω–∞ –∫—ä–º –Ω–æ—Ä–º–∞–ª–Ω–∏—è –º—É –≤–∏–¥
              cameraButton.classList.remove("screenshot-mode");
            });
          },
          showAlert(message, type = "success") {
            this.alertMessage = message;
            this.alertType = type;

            setTimeout(() => {
              this.alertMessage = "";
              this.alertType = "";
            }, 5000); // –ò–∑—á–µ–∑–≤–∞ —Å–ª–µ–¥ 5 —Å–µ–∫—É–Ω–¥–∏
          },
        },
        watch: {
          selectedYear(newYear) {
            // –ê–∫–æ –∏–º–∞ –∑–∞–ø–∞–º–µ—Ç–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –ø–æ–ª–∑–≤–∞–π –Ω–µ—è
            const storedSelectedMonths = localStorage.getItem(`selectedMonths_${newYear}`);
            if (storedSelectedMonths) {
              this.selectedMonths = JSON.parse(storedSelectedMonths);
            } else {
              // –ê–∫–æ –Ω—è–º–∞ ‚Äì –æ–ø–∏—Ç–∞–π –¥–∞ –≤–∑–µ–º–µ—à –æ—Ç —Ç–µ—Ä–º–∏–Ω–∏ –∑–∞ —Å—ä–æ—Ç–≤–µ—Ç–Ω–∞—Ç–∞ –≥–æ–¥–∏–Ω–∞
              const yearData = this.terms[newYear];
              if (yearData) {
                this.selectedMonths = Object.keys(yearData).map((m) => parseInt(m));
              } else {
                this.selectedMonths = [];
              }
            }

            // –û–±–Ω–æ–≤—è–≤–∞ selectedDay –∑–∞ –≤—Å–µ–∫–∏ –Ω–æ–≤–æ—Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω –º–µ—Å–µ—Ü
            this.selectedMonths.forEach((index) => {
              if (!this.selectedDay[index]) {
                this.$set(this.selectedDay, index, "");
              }
            });

            // –ó–∞–ø–∞–∑–≤–∞–º–µ –Ω–æ–≤–æ—Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏—Ç–µ –º–µ—Å–µ—Ü–∏
            this.saveSelectedMonths();

            // –ó–∞–ø–∞–∑–≤–∞–º–µ —Ç–µ–∫—É—â–∏—è —Å—Ç–µ–π—Ç –≤ –∞—Ä—Ö–∏–≤ (–∑–∞ persist —Å–ª–µ–¥ —Ä–µ—Ñ—Ä–µ—à)
            const fullData = {
              terms: this.terms,
              config: {
                selectedYear: this.selectedYear,
                selectedLanguage: this.selectedLanguage,
                selectedMonths: this.selectedMonths,
                rememberSelection: true,
              },
            };
            localStorage.setItem("calendar_backup", JSON.stringify(fullData));
          },
          terms: {
            handler() {
              this.saveToLocalStorage();

              // —Å—ä—â–æ —Ç–∞–∫–∞ –æ–±–Ω–æ–≤—è–≤–∞–º–µ –∞—Ä—Ö–∏–≤
              const fullData = {
                terms: this.terms,
                config: {
                  selectedYear: this.selectedYear,
                  selectedLanguage: this.selectedLanguage,
                  selectedMonths: this.selectedMonths,
                  rememberSelection: true,
                },
              };
              localStorage.setItem("calendar_backup", JSON.stringify(fullData));
            },
            deep: true,
          },
        },
      });
    </script>
  </body>
</html>
